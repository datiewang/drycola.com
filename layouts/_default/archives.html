{{- define "main" }}

<header class="page-header">
  <h1>
    {{ .Title }}
    {{- if (.Param "ShowRssButtonInSectionTermList") }}
    {{- $rss := (.OutputFormats.Get "rss") }}
    {{- if (eq .Kind `page`) }}
    {{- $rss = (.Parent.OutputFormats.Get "rss") }}
    {{- end }}
    {{- with $rss }}
    <a href="{{ .RelPermalink }}" title="RSS" aria-label="RSS">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round" height="23">
        <path d="M4 11a9 9 0 0 1 9 9" />
        <path d="M4 4a16 16 0 0 1 16 16" />
        <circle cx="5" cy="19" r="1" />
      </svg>
    </a>
    {{- end }}
    {{- end }}
  </h1>
  {{- if .Description }}
  <div class="post-description">
    {{ .Description }}
  </div>
  {{- end }}
</header>

{{- $pages := where site.RegularPages "Type" "in" site.Params.mainSections }}

{{- if site.Params.ShowAllPagesInArchive }}
{{- $pages = site.RegularPages }}
{{- end }}

{{- range $pages.GroupByPublishDate "2006" }}
{{- if ne .Key "0001" }}
<div class="archive-year-section">
  {{- $year := replace .Key "0001" "" }}
  <div class="archive-year-header">
    <h2 class="year-title">{{ $year }}</h2>
    <span class="year-count">{{ len .Pages }} 篇文章</span>
  </div>
  
  <div class="archive-months-grid">
    {{- range .Pages.GroupByDate "January" }}
    <article class="archive-month-card">
      <div class="month-header">
        <div class="month-title-row">
          <h3 class="month-title">{{ .Key }}</h3>
          <span class="month-count">{{ len .Pages }} 篇</span>
        </div>
        <div class="month-accent-line"></div>
      </div>
      
      <div class="month-posts">
        {{- range .Pages }}
        {{- if eq .Kind "page" }}
        <div class="archive-post-item">
          <a href="{{ .Permalink }}" class="archive-post-link">
            <div class="post-info">
              <div class="post-date">{{ .PublishDate.Format "01月02日" }}</div>
              <h4 class="post-title">{{ .Title }}</h4>
              <div class="post-meta">
                {{- range first 1 .Params.categories }}
                <span class="post-category">{{ . }}</span>
                {{- end }}
                {{- range first 1 .Params.authors }}
                <span class="post-author">{{ . }}</span>
                {{- end }}
                {{- if .Params.tags }}
                <span class="post-tags">
                  {{- range first 2 .Params.tags }}
                  <span class="post-tag">#{{ . }}</span>
                  {{- end }}
                </span>
                {{- end }}
              </div>
            </div>
          </a>
        </div>
        {{- end }}
        {{- end }}
      </div>
    </article>
    {{- end }}
  </div>
</div>
{{- end }}
{{- end }}

<style>
.archive-year-section {
  margin-bottom: 3rem;
}

.archive-year-header {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 2rem;
  padding-bottom: 1rem;
  border-bottom: 2px solid var(--border);
}

.year-title {
  margin: 0;
  font-size: 1.75rem;
  font-weight: 700;
  color: var(--primary);
}

.year-count {
  background: var(--code-bg);
  color: var(--primary);
  padding: 0.25rem 0.75rem;
  border-radius: 20px;
  font-size: 0.875rem;
  font-weight: 600;
}

.archive-months-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
  gap: 1.5rem;
}

.archive-month-card {
  background: var(--theme);
  border: 1px solid var(--border);
  border-radius: 12px;
  overflow: hidden;
  transition: all 0.3s ease;
  position: relative;
}

.archive-month-card:hover {
  border-color: var(--tertiary);
  box-shadow: 0 8px 24px rgba(0,0,0,0.08);
  transform: translateY(-2px);
}

.month-header {
  padding: 1.5rem 1.5rem 0.5rem;
  position: relative;
}

.month-title-row {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 0.75rem;
}

.month-title {
  margin: 0;
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--primary);
}

.month-count {
  font-size: 0.8rem;
  color: var(--secondary);
  font-weight: 500;
  background: var(--code-bg);
  padding: 0.25rem 0.5rem;
  border-radius: 12px;
}

.month-accent-line {
  height: 2px;
  background: linear-gradient(90deg, var(--tertiary) 0%, transparent 100%);
  border-radius: 1px;
  margin-top: 0.75rem;
}

.month-posts {
  padding: 0.5rem 1.5rem 1.5rem;
}

.archive-post-item {
  padding: 0.75rem 0;
  border-bottom: 1px solid var(--border);
}

.archive-post-item:last-child {
  border-bottom: none;
}

.archive-post-link {
  text-decoration: none;
  display: block;
  transition: all 0.2s ease;
}

.archive-post-link:hover .post-title {
  color: var(--tertiary);
}

.post-info {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.post-date {
  font-size: 0.8rem;
  color: var(--secondary);
  font-weight: 500;
}

.post-title {
  margin: 0;
  font-size: 0.95rem;
  font-weight: 500;
  line-height: 1.4;
  color: var(--primary);
  transition: color 0.2s ease;
}

.post-meta {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  flex-wrap: wrap;
}

.post-category {
  background: var(--code-bg);
  color: var(--primary);
  padding: 0.125rem 0.5rem;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 500;
}

.post-author {
  background: var(--tertiary);
  color: var(--theme);
  padding: 0.125rem 0.5rem;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 500;
}

.post-tags {
  display: flex;
  gap: 0.25rem;
}

.post-tag {
  background: var(--code-bg);
  padding: 0.125rem 0.375rem;
  border-radius: 4px;
  font-size: 0.7rem;
  color: var(--secondary);
}


@media (max-width: 768px) {
  .archive-months-grid {
    grid-template-columns: 1fr;
    gap: 1rem;
  }
  
  .archive-year-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.5rem;
  }
  
  .month-header,
  .month-posts {
    padding-left: 1rem;
    padding-right: 1rem;
  }
  
  .post-meta {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.25rem;
  }
}
</style>

{{- end }}{{/* end main */}}